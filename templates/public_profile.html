{% extends 'base.html' %}
{% block title %}@{{ target_user.username }}'s Profile{% endblock %}

{% block content %}
<style>
    body {
        background-color: #2a2a2e;
        color: #f0f0f0;
    }

    .public-profile-container {
        max-width: 900px;
        margin: 2rem auto;
        display: flex;
        gap: 20px;
        padding: 0 1rem;
    }

    /* Sidebar */
    .profile-sidebar {
        flex: 0 0 260px;
        background-color: #2f2f33;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 0 30px rgba(0,0,0,0.08);
    }
    .profile-sidebar img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        border: 2px solid #666;
        object-fit: cover;
        display: block;
        margin: auto;
    }
    .profile-sidebar h3 {
        text-align: center;
        margin: 0.75rem 0 0.5rem;
        font-size: 1.25rem;
        font-weight: 700;
    }
    .profile-sidebar p.bio {
        text-align: center;
        color: #ccc;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }

    .profile-stats {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
    }
    .profile-stats .stat {
        flex: 1;
        text-align: center;
    }
    .profile-stats .stat strong {
        display: block;
        font-size: 1.1rem;
        color: #fff;
    }
    .profile-stats .stat small {
        font-size: 0.8rem;
        color: #aaa;
    }

    .public-actions {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 1rem;
    }
    .public-actions .btn {
        padding: 4px 8px;
        font-size: 0.8rem;
    }

    /* Tweets Column */
    .tweets-column {
        flex: 1;
        max-height: calc(100vh - 150px);
        overflow-y: auto;
    }
    .tweets-column h5 {
        font-size: 1rem;
        margin-bottom: 0.5rem;
    }

    /* Tweet Card */
    .tweet-card {
        background-color: #1f1f23;
        border: 1px solid #444;
        border-radius: 10px;
        padding: 0.6rem;
        margin-bottom: 0.6rem;
        font-size: 0.85rem;
    }
    .tweet-caption {
        font-weight: 600;
        margin-bottom: 0.4rem;
    }
    .tweet-card img {
        width: 100%;
        border-radius: 8px;
        margin-bottom: 0.5rem;
    }
    .tweet-meta {
        font-size: 0.75rem;
        color: #aaa;
        margin-bottom: 0.4rem;
    }

    .tweet-card .actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .btn-sm-custom {
        font-size: 0.7rem;
        padding: 3px 6px;
    }
</style>

<div class="public-profile-container">
  <aside class="profile-sidebar">
    <img src="{{ target_user.profile.profile_pic.url }}" alt="Profile Picture">
    <h3>@{{ target_user.username }}</h3>
    <p class="bio">{{ target_user.profile.bio|default:"No bio yet." }}</p>
    <div class="profile-stats">
      <div class="stat">
        <strong>{{ target_user.profile.followers.count }}</strong>
        <small>Followers</small>
      </div>
      <div class="stat">
        <strong>{{ target_user.profile.following.count }}</strong>
        <small>Following</small>
      </div>
    </div>
    {% if user.is_authenticated and user != target_user %}
    <div class="public-actions">
      <button class="btn-follow btn {% if is_following %}btn-danger{% else %}btn-outline-primary{% endif %}" data-username="{{ target_user.username }}">
        {% if is_following %}Unfollow{% else %}Follow{% endif %}
      </button>
      {% if user.profile in target_user.profile.followers.all and target_user.profile in user.profile.followers.all %}
      <a href="{% url 'chat_detail' target_user.username %}" class="btn btn-outline-light">Message</a>
      {% endif %}
    </div>
    {% endif %}
  </aside>

  <section class="tweets-column">
    <h5>Tweets</h5>
    {% for tweet in target_user.tweets.all|dictsortreversed:"created_at" %}
    <div class="tweet-card">
      {% if tweet.caption %}<p class="tweet-caption">{{ tweet.caption }}</p>{% endif %}
      {% if tweet.image %}<img src="{{ tweet.image.url }}" alt="Tweet Image">{% endif %}
      {% if tweet.content %}<p>{{ tweet.content }}</p>{% endif %}
      <p class="tweet-meta">{{ tweet.created_at|date:"M d, H:i" }}</p>
      <div class="actions">
        <button class="btn-like btn btn-sm-custom {% if user in tweet.likes.all %}btn-danger{% else %}btn-outline-danger{% endif %}" data-tweet-id="{{ tweet.id }}">
          ❤️ <span class="like-count">{{ tweet.total_likes }}</span>
        </button>
        <div>
          <a href="{% url 'view_tweet' tweet.id %}#comment-form" class="btn btn-sm-custom btn-outline-info">Comment</a>
          <a href="{% url 'view_tweet' tweet.id %}" class="btn btn-sm-custom btn-outline-secondary">View</a>
        </div>
      </div>
    </div>
    {% empty %}
    <p class="text-muted text-center">No tweets yet.</p>
    {% endfor %}
  </section>
</div>

<script>
// Follow toggle
... same JS ...
</script>
{% endblock %}











